{% extends "base.html" %}

{% block baseHead %}
<link rel="stylesheet" href="/static/css/login.css">
<!-- add SEO -->
{% endblock %}


{% block baseBody %}
<nav>
    <div class="nav-left-container">
        <a href="/">
            <svg viewBox="0 0 410 109" style="height: 100%;" preserveAspectRatio="xMidYMid meet" class="css-8aabad"
                id="dgegagha">
                <defs id="SvgjsDefs2161">
                    <linearGradient id="SvgjsLinearGradient2168">
                        <stop id="SvgjsStop2169" stop-color="#006838" offset="0"></stop>
                        <stop id="SvgjsStop2170" stop-color="#96cf24" offset="1"></stop>
                    </linearGradient>
                </defs>
                <g id="SvgjsG2162" featurekey="symbolContainer" transform="matrix(1,0,0,1,0,0)" fill="#111">
                    <rect width="110" height="109"></rect>
                </g>
                <g id="SvgjsG2163" featurekey="monogramFeature-0"
                    transform="matrix(1.8430753250050795,0,0,1.8430753250050795,15.466031993639358,-17.069509952010947)"
                    fill="#fff">
                    <path
                        d="M29.28 37.08 c6.9 0.96 11.16 5.16 11.16 10.92 c0 7.08 -6.24 12 -20.1 12 l-16.44 0 c-0.84 0 -1.44 -0.42 -1.44 -1.14 l0 -0.24 c0 -1.68 2.4 -2.4 2.4 -5.16 l0 -29.52 c0 -2.76 -2.4 -3.48 -2.4 -5.16 l0 -0.24 c0 -0.72 0.6 -1.14 1.44 -1.14 l16.62 0 c10.8 0 15.72 4.8 15.72 10.8 c0 4.5 -2.76 7.8 -6.96 8.88 z M15.66 24.72 l0 7.56 c0 1.98 1.32 3.12 3.24 3.12 l3 0 c3.06 0 5.04 -2.22 5.04 -5.64 c0 -5.16 -2.7 -8.16 -6.78 -8.16 l-1.68 0 c-1.56 0 -2.82 0.72 -2.82 3.12 z M23.04 55.8 c3.84 0 6 -2.52 6 -6.24 c0 -4.44 -3.66 -9.96 -10.86 -9.96 l-2.52 0 l0 11.1 c0 2.88 1.74 5.1 4.5 5.1 l2.88 0 z">
                    </path>
                </g>
                <g id="SvgjsG2164" featurekey="nameFeature-0"
                    transform="matrix(2.0408161449540345,0,0,2.0408161449540345,125.1020420306199,-6.102038138072011)"
                    fill="#000">
                    <path
                        d="M15.88 24.6 c3.68 0.84 6.08 3.88 6.08 7.4 c0 4.92 -3.2 8 -10.12 8 l-9.44 0 l0 -28 l9.56 0 c5.48 0 8.2 3.12 8.2 6.76 c0 2.68 -1.52 4.84 -4.28 5.84 z M11.72 14.96 l-6 0 l0 8.56 l6 0 c3.2 0 5.16 -1.76 5.16 -4.32 c0 -2.64 -1.84 -4.24 -5.16 -4.24 z M11.72 37.04 c4.8 0 6.92 -1.96 6.92 -5.32 c0 -2.92 -2.12 -5.44 -6.72 -5.44 l-6.2 0 l0 10.76 l6 0 z M28.919999999999998 11.719999999999999 l0 28.28 l-3.28 0 l0 -28.28 l3.28 0 z M43.239999999999995 18.84 c4.72 0 10.68 3.6 10.68 10.8 s-5.96 10.76 -10.68 10.76 s-10.64 -3.56 -10.64 -10.76 s5.92 -10.8 10.64 -10.8 z M43.239999999999995 21.76 c-3.36 0 -7.44 2.6 -7.44 7.88 c0 5.24 4.08 7.84 7.44 7.84 c3.4 0 7.48 -2.6 7.48 -7.84 c0 -5.28 -4.08 -7.88 -7.48 -7.88 z M74.64 19.2 l3.28 0 l0 20.8 c0 6.28 -5.52 8.24 -9.52 8.24 c-3.2 0 -5.24 -0.84 -6.24 -1.56 l0 -2.8 c1 0.72 3.04 1.56 6.24 1.56 c3.6 0 6.24 -1.96 6.24 -5.44 l0 -4 c-0.96 2.4 -3.8 4.4 -7.48 4.4 c-4.72 0 -10.44 -3.56 -10.44 -10.8 c0 -7.16 5.72 -10.76 10.44 -10.76 c3.68 0 6.52 2.04 7.48 4.28 l0 -3.92 z M67.52 37.48 c3.56 0 7.28 -2.52 7.28 -7.88 c0 -5.32 -3.72 -7.84 -7.28 -7.84 c-3.52 0 -7.6 2.6 -7.6 7.84 c0 5.28 4.08 7.88 7.6 7.88 z M85.76 11.719999999999999 l0 2.92 l-3.28 0 l0 -2.92 l3.28 0 z M85.76 19.2 l0 20.8 l-3.28 0 l0 -20.8 l3.28 0 z M97.68 14.079999999999998 c-2.2 0 -3.28 1.08 -3.28 3.64 l0 1.48 l5.88 0 l0 2.76 l-5.88 0 l0 18.04 l-3.28 0 l0 -18.04 l-2.28 0 l0 -2.76 l2.28 0 l0 -1.48 c0 -5.48 3.64 -6.4 6.28 -6.4 c1.72 0 3.32 0.48 4.52 1.24 l-1.2 2.28 c-0.92 -0.44 -1.84 -0.76 -3.04 -0.76 z M121.04 19.16 l3.28 0 l-12.64 28.44 l-3.28 0 l3.72 -8.28 l-9 -20.16 l3.28 0 l7.32 16.56 z M138.6 18.88 c0.36 0 0.68 0 1 0.08 l0 3.08 c-0.32 -0.08 -0.68 -0.08 -0.96 -0.08 c-3.96 0 -7.2 2.84 -7.76 7.52 l0 10.52 l-3.28 0 l0 -20.8 l3.28 0 l0 5.48 c0.76 -3.08 3.6 -5.8 7.72 -5.8 z">
                    </path>
                </g>
            </svg>
        </a>
    </div>
    <div class="nav-right-container">
        <a href="" class="dnon">Our story</a>
        <a href="" class="dnon">Membership</a>
        <a href="/new-story">Write</a>
        <a href="/signup">Sign Up</a>
    </div>
</nav>

<div class="root email-inp">
    <div class="title">
        <h2>Welcome back.</h2>
    </div>
    <div class="small">
        Enter the email address associated with your account, and we’ll send a magic link to your inbox.
    </div>
    <div id="errordiv" style="padding-bottom: 1rem; margin-top: -1rem; color: rgb(201, 74, 74); height: 20px;"></div>
    <div class="input-container">
        <h4>Your email</h4>
        <div class="input" id="input-container"><input type="email" id="emailInput" oninput="resetError()" onkeypress="if (event.keyCode === 13)flowContinue();"></div>
        <button onclick="flowContinue()">Continue</button>
    </div>
</div>


<div class="root otp-inp" style="display: none;">
    <div class="title">
        <h2>Check your inbox.</h2>
    </div>
    <div class="small">
        Enter the code we sent to<br><b><span id="setmail"></span></b> to sign in.
    </div>
    <div id="errordivotp" style="padding-bottom: 1rem; margin-top: -1rem; color: rgb(201, 74, 74); height: 20px;"></div>
    <!-- <div style="display: flex; gap: .5rem; margin-bottom: 1rem; margin-top: -.5rem; align-items: center;">
        <span>Remember User:</span>
        <input type="checkbox" id="remember">
    </div> -->
    <div class="input-container">
        <h4>Enter Code Here</h4>
        <div class="input"><input type="text" id="otpInput"  oninput="resetError()" onkeypress="if (event.keyCode === 13)LoginAccount();"></div>
        <div style="display: flex; align-items: baseline; justify-content: space-evenly;">
            <div style="margin-bottom: 1rem; margin-top: -.5rem;">
                <span>Remember:</span>
                <input type="checkbox" id="remember" style="margin-left: .5rem;">
            </div>
            <div>
                <button onclick="LoginAccount()">OK</button>
            </div>
        </div>
        <!-- <button onclick="LoginAccount()" >OK</button> -->
        <div>
            <button onclick="flowBack()" style="margin-top: .5rem; background-color: unset; color: #1A8917; padding: 0; margin: 16px 16px 8px 16px;"><pre>&lt;  Back</pre></button>
        </div>
    </div>
</div>
<script>
    const otpInp = document.getElementsByClassName('otp-inp')[0];
    const emailInp = document.getElementsByClassName('email-inp')[0];
    const emailInput = document.getElementById('emailInput');
    const otpInput = document.getElementById('otpInput');
    const setmail = document.getElementById('setmail');
    const remember = document.getElementById('remember');
    let errordiv = document.getElementById('errordiv');
    function resetError(){
        errordiv.innerHTML = '';
    }
    function flowContinue(){
        if(emailInput.value != ''){
            setmail.innerHTML = emailInput.value;
            otpInp.style.display = 'flex';
            emailInp.style.display = 'none';
            resetError();
            errordiv = document.getElementById('errordivotp');
        }else{
            errordiv.innerHTML = '<b>Please enter a valid email address. ⚠</b>';
        }
    }
    function flowBack(){
        emailInp.style.display = 'flex';
        otpInp.style.display = 'none';
        errordiv = document.getElementById('errordiv');
    }
    function LoginAccount(){
        console.log(remember.value);
        if(otpInput.value != ''){
            // TODO send sha256 not real password
            let data = {
                email: emailInput.value,
                otp: otpInput.value,
                remember: remember.checked
            };
            // username: userInput.value,
            fetch("/login", {
                method: "POST",
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify(data)
            }).then(res=>res.json()).then(res => {
                if(res['ok']){
                    window.location.replace('/');   
                }else{
                    console.log('Error !!!');
                }
            });
            
            errordiv.innerHTML='';
        }else{
            errordiv.innerHTML = '<b>Please enter a valid otp. ⚠</b>';
        }
    }
</script>
{% endblock %}